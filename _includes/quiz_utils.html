<style>
  .quiz-container {
    max-width: 600px;
    margin: 20px auto;
    padding: 20px;
    font-family: Arial, sans-serif;
  }

  /* Progress Bar Styles */
  .progress-container {
    margin-bottom: 30px;
  }

  .progress-bar {
    width: 100%;
    height: 20px;
    background-color: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 10px;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #45a049);
    border-radius: 10px;
    transition: width 0.3s ease;
    width: 0%;
  }

  .progress-text {
    text-align: center;
    font-weight: bold;
    color: #555;
    font-size: 14px;
  }

  /* Question Styles */
  .quiz-question {
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .quiz-question h3 {
    margin-top: 0;
    color: #333;
  }

  .quiz-question label {
    display: flex;
    align-items: center;
    margin: 0.2em 0;
    padding: 0.4em;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .quiz-question label:hover {
    background-color: #f0f0f0;
  }

  .quiz-question label input[type="radio"] {
    margin-right: 8px;
  }

  .quiz-question.disabled label {
    pointer-events: none;
    opacity: 0.6;
  }

  .quiz-question.disabled input[type="radio"] {
    pointer-events: none;
  }

  /* Button Styles */
  button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    margin-right: 10px;
    transition: background-color 0.2s ease;
  }

  button:hover {
    background-color: #0056b3;
  }

  .next-btn {
    background-color: #28a745;
  }

  .next-btn:hover {
    background-color: #1e7e34;
  }

  .retry-btn {
    background-color: #6c757d;
  }

  .retry-btn:hover {
    background-color: #545b62;
  }

  /* Results Styles */
  .quiz-results {
    background-color: #f8f9fa;
    border: 2px solid #007bff;
    border-radius: 10px;
    padding: 30px;
    text-align: center;
    max-width: 100%;
    word-wrap: break-word;
  }

  .quiz-results h3 {
    color: #007bff;
    margin-top: 0;
  }

  #finalScore {
    font-size: 16px;
    margin: 20px 0;
    padding: 20px;
    background-color: white;
    border-radius: 8px;
    border: 1px solid #ddd;
    text-align: left;
    line-height: 1.5;
    max-height: 400px;
    overflow-y: auto;
  }
</style>

<script>
// ============================================
// GOOGLE SPREADSHEET INFORMATION
// ============================================
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyTeDkaHgACI_vIbx2tJ-Tyi5UqYPxU3Y5YnXUW9jImq2QtudNVSoREP-NTwQyw-Eg/exec';

// ============================================
// QUIZ CONFIGURATION - ADD/REMOVE QUESTIONS HERE
// ============================================
const quizQuestions = [
  {
    question: "Bạn có để ý cách mình ngồi trong ngày không?",
    options: [
      { text: "Không để ý mấy, hoặc chưa biết nó ảnh hưởng đến việc sinh", score: 1 },
      { text: "Cũng có lúc để ý, lúc thì quên", score: 2 },
      { text: "Có, mình cố gắng giữ tư thế tốt mỗi ngày", score: 3 }
    ]
  },
  {
    question: "Khi ngủ, bạn thường nằm nghiêng bên nào?",
    options: [
      { text: "Nằm ngửa hoặc tư thế nào thấy dễ ngủ là được", score: 1 },
      { text: "Thỉnh thoảng nghiêng trái", score: 2 },
      { text: "Mình hay nằm nghiêng trái để giúp tuần hoàn tốt hơn", score: 3 }
    ]
  },
  {
    question: "Bạn đã từng thử tập squat hoặc tư thế “cái bàn” chưa?",
    options: [
      { text: "Chưa biết đó là gì hoặc có ích gì", score: 1 },
      { text: "Có nghe qua nhưng chưa tập thường xuyên", score: 2 },
      { text: "Có, mình tập 1–2 lần mỗi tuần hoặc hơn", score: 3 }
    ]
  },
  {
    question: "Mỗi ngày bạn có di chuyển nhẹ nhàng không?",
    options: [
      { text: "Chủ yếu ngồi nhiều, ít vận động", score: 1 },
      { text: "Thỉnh thoảng đi bộ hoặc vận động nhẹ", score: 2 },
      { text: "Mỗi ngày mình đều có lúc đi bộ hoặc tập yoga nhẹ", score: 3 }
    ]
  },
  {
    question: "Khi thấy căng thẳng hay đau nhẹ, bạn có biết cách để cơ thể thả lỏng lại không?",
    options: [
      { text: "Không, mình thường cứng đơ cả người", score: 1 },
      { text: "Có thể thả lỏng một phần như vai hay cổ", score: 2 },
      { text: "Có, mình tập trung thả lỏng cả cơ thể, đặc biệt là bụng và mặt", score: 3 }
    ]
  },
  {
    question: "Khi lo lắng, bạn có biết cách dùng hơi thở để bình tĩnh lại không?",
    options: [
      { text: "Không biết hoặc chưa từng thử", score: 1 },
      { text: "Có biết nhưng chưa quen dùng", score: 2 },
      { text: "Có, mình hay dùng thở để xoa dịu bản thân", score: 3 }
    ]
  },
  {
    question: "Bạn có từng học kỹ thuật thở cho từng giai đoạn chuyển dạ chưa?",
    options: [
      { text: "Chưa nghe bao giờ", score: 1 },
      { text: "Có đọc hoặc xem qua nhưng chưa tập", score: 2 },
      { text: "Có học và thực hành đều", score: 3 }
    ]
  },
  {
    question: "Bạn hiểu tới đâu về các giai đoạn của quá trình sinh?",
    options: [
      { text: "Chưa tìm hiểu kỹ", score: 1 },
      { text: "Biết sơ sơ nhưng chưa biết phải làm gì từng giai đoạn", score: 2 },
      { text: "Mình hiểu rõ và biết mình sẽ làm gì trong từng giai đoạn", score: 3 }
    ]
  },
  {
    question: "Bạn có từng tập cách cảm nhận hoặc điều khiển cơ sàn chậu không?",
    options: [
      { text: "Chưa bao giờ nghe tới hoặc biết làm sao tập", score: 1 },
      { text: "Có nghe nói nhưng không chắc mình làm đúng", score: 2 },
      { text: "Có, mình cảm nhận được rõ ràng khi siết/thả", score: 3 }
    ]
  },
  {
    question: "Bạn có hay bị són tiểu khi ho, hắt hơi hoặc cười to không?",
    options: [
      { text: "Có, xảy ra khá thường xuyên", score: 1 },
      { text: "Thỉnh thoảng bị", score: 2 },
      { text: "Không bị", score: 3 }
    ]
  },
  {
    question: "Bạn đã từng tìm hiểu hoặc bắt đầu tập phục hồi sàn chậu chưa?",
    options: [
      { text: "Chưa từng nghe đến", score: 1 },
      { text: "Có biết nhưng chưa bắt đầu", score: 2 },
      { text: "Có rồi, mình đang tập hoặc đã lên kế hoạch", score: 3 }
    ]
  },
  {
    question: "Bạn có biết tư thế nào giúp em bé đi xuống dễ hơn không?",
    options: [
      { text: "Chưa tìm hiểu", score: 1 },
      { text: "Có nghe nói vài tư thế nhưng chưa quen tập", score: 2 },
      { text: "Biết rõ và đang áp dụng như đứng tựa, nghiêng người, all fours...", score: 3 }
    ]
  },
  {
    question: "Bạn có từng tập thả lỏng vùng âm đạo và tầng sinh môn không?",
    options: [
      { text: "Chưa biết có thể tập điều này", score: 1 },
      { text: "Có nghe qua nhưng chưa thực hành được", score: 2 },
      { text: "Có, mình đang luyện tập và cảm nhận rõ", score: 3 }
    ]
  },
  {
    question: "Nếu ca sinh diễn ra không như kế hoạch, bạn sẽ...",
    options: [
      { text: "Rất lo lắng, dễ hoảng", score: 1 },
      { text: "Lo nhưng sẽ cố giữ bình tĩnh", score: 2 },
      { text: "Mình đã chuẩn bị tinh thần để linh hoạt và ứng biến", score: 3 }
    ]
  },
  {
    question: "Khi nghĩ đến sinh con, bạn cảm thấy...",
    options: [
      { text: "Sợ và không tin mình làm được", score: 1 },
      { text: "Lo nhưng vẫn cố nghĩ tích cực", score: 2 },
      { text: "Có niềm tin là mình sẽ làm được", score: 3 }
    ]
  },
  {
    question: "Bạn đã chuẩn bị kế hoạch sinh (birth plan) và nói chuyện với bác sĩ chưa?",
    options: [
      { text: "Chưa từng nghĩ tới hoặc chưa tìm hiểu", score: 1 },
      { text: "Có ý tưởng nhưng chưa nói chuyện với ai", score: 2 },
      { text: "Mình đã viết kế hoạch và thảo luận với bác sĩ/nữ hộ sinh", score: 3 }
    ]
  },
  {
    question: "Bạn đang ở tuần thai thứ mấy rồi?",
    options: [
      { text: "Dưới 28 tuần", score: 1 },
      { text: "28–36 tuần", score: 2 },
      { text: "Trên 36 tuần", score: 3 }
    ]
  }
];

// ============================================
// QUIZ LOGIC - DON'T CHANGE BELOW THIS LINE
// ============================================
let currentQuestion = 0;
let totalQuestions = quizQuestions.length;
let totalScore = 0;
let answers = {};

function initializeQuiz() {
  currentQuestion = 0;
  totalScore = 0;
  answers = {};
  totalQuestions = quizQuestions.length;

  // Clear container
  document.getElementById('questionContainer').innerHTML = '';
  document.getElementById('results').style.display = 'none';

  // Generate all questions
  generateQuestions();

  // Show first question
  showQuestion(0);
  updateProgress();
}

function generateQuestions() {
  const container = document.getElementById('questionContainer');

  quizQuestions.forEach((q, index) => {
    const questionDiv = document.createElement('div');
    questionDiv.className = 'quiz-question';
    questionDiv.id = `question${index}`;
    questionDiv.style.display = 'none';

    let optionsHTML = '';
    q.options.forEach((option, optionIndex) => {
      optionsHTML += `
        <label>
          <input type="radio" name="q${index}" value="${optionIndex}" data-score="${option.score}"> ${option.text}
        </label>
      `;
    });

    questionDiv.innerHTML = `
      <h3>Câu ${index + 1}</h3>
      <p><strong>${q.question}</strong></p>
      <form>
        ${optionsHTML}
        <br>
        <button type="button" class="quiz-action-btn" onclick="handleQuizAction(this, ${index})">Gửi Câu Trả Lời</button>
      </form>
      <p class="quiz-feedback" style="font-weight:bold;"></p>
    `;

    container.appendChild(questionDiv);
  });
}

function showQuestion(questionIndex) {
  // Hide all questions
  document.querySelectorAll('.quiz-question').forEach(q => {
    q.style.display = 'none';
  });

  // Show current question
  const currentQuestionDiv = document.getElementById(`question${questionIndex}`);
  if (currentQuestionDiv) {
    currentQuestionDiv.style.display = 'block';
  }
}

function updateProgress() {
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');

  const progressPercentage = Math.round(((currentQuestion + 1) / totalQuestions) * 100);

  progressFill.style.width = progressPercentage + '%';
  progressText.textContent = `Câu ${currentQuestion + 1} / ${totalQuestions} (${progressPercentage}%)`;
}

function handleQuizAction(button, questionIndex) {
  const questionDiv = button.closest('.quiz-question');
  const feedback = questionDiv.querySelector('.quiz-feedback');
  const isLastQuestion = questionIndex === quizQuestions.length - 1;
  const nextButtonText = isLastQuestion ? 'Xem Kết Quả' : 'Câu Tiếp Theo';

  // Check if user has selected an answer
  const selectedInput = questionDiv.querySelector(`input[name="q${questionIndex}"]:checked`);
  if (!selectedInput) {
    feedback.textContent = 'Vui lòng chọn một câu trả lời trước khi gửi.';
    feedback.style.color = '#721c24';
    feedback.style.display = 'block';
    return;
  }

  // Clear any error message
  feedback.style.display = 'none';

  // Lock in the answer (disable all inputs for this question)
  const allInputs = questionDiv.querySelectorAll(`input[name="q${questionIndex}"]`);
  allInputs.forEach(input => {
    input.disabled = true;
  })

  // Store the answer
  const userAnswerIndex = parseInt(selectedInput.value);
  const userScore = parseInt(selectedInput.dataset.score);

  answers[`q${questionIndex}`] = {
    selected: userAnswerIndex,
    score: userScore,
    question: quizQuestions[questionIndex].question,
    selectedText: quizQuestions[questionIndex].options[userAnswerIndex].text
  };
  totalScore += userScore;

  // Disable the current question (visual feedback that it's locked)
  questionDiv.classList.add('disabled');

  // Move to next question or show results
  if (isLastQuestion) {
    showResults();
  } else {
    currentQuestion++;
    showQuestion(currentQuestion);
    updateProgress();
  }
}

function showResults() {
  // Hide current question
  document.querySelectorAll('.quiz-question').forEach(q => {
    q.style.display = 'none';
  });

  // Update progress to 100%
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');
  progressFill.style.width = '100%';
  progressText.textContent = 'Hoàn Thành! (100%)';

  // Show results with scoring message
  const resultsDiv = document.getElementById('results');
  const finalScore = document.getElementById('finalScore');

  // Determine message based on total score
  let scoreMessage = '';
  if (totalScore >= 44) {
    scoreMessage = `
      <strong>Bạn biết khá rõ rồi – và mình sẽ giúp bạn nhìn toàn cảnh.</strong><br><br>
      Bạn có vẻ là người đọc nhiều, học kỹ, thực hành tốt, rất tốt :) Nhưng chính vì có quá nhiều lời khuyên ở YouTube, Facebook, báo chí, sách vở, nên đôi khi bạn lại rơi vào cảm giác thiếu định hướng: nên làm cái gì – lúc nào – và vì sao. Cái bạn cần không phải thêm việc để làm, mà cái thêm cái nhìn tổng quát hơn.<br><br>
      <strong>💬 Mình sẽ giúp bạn</strong> nhìn lại bức tranh lớn – và sắp xếp lại các mảnh ghép theo thứ tự phù hợp với chính bạn.<br><br>
    `;
  } else if (totalScore >= 34 && totalScore < 44) {
    scoreMessage = `
      <strong>Bạn đã có nền tảng – chỉ cần ai đó đồng hành thêm một chút.</strong><br><br>
      Bạn không còn xa lạ với khái niệm về sinh thường, tư thế, hay hơi thở. Có thể bạn đã bắt đầu tập, bắt đầu thở, bắt đầu tin mình có thể sinh tự nhiên. Nhưng điều bạn còn thiếu là sự đều đặn – và một người tạo thêm động lực để bạn không bỏ cuộc giữa chừng.<br><br>
      <strong>💬 Đó chính là lý do</strong> mình thiết kế hành trình đồng hành này – để bạn giữ nhịp, giữ kết nối với cơ thể và hiểu cơ thể sâu hơn. Hành trình mang thai là 1 hành trình cực kỳ thiêng liêng, trong đời chỉ có vài lần, hãy tận dụng cơ hội để hiểu hơn về mình và cơ thể mình nhé.<br><br>
    `;
  } else if (totalScore >= 17 && totalScore < 34) {
    scoreMessage = `
      <strong>Cơ thể bạn đang lên tiếng – và bạn đã bắt đầu biết lắng nghe.</strong><br><br>
      Bạn có thể đã từng nghe đâu đó về cơ sàn chậu, hoặc xem video về hơi thở, nhưng vẫn thấy hoang mang giữa quá nhiều luồng thông tin. Điều khó nhất không phải là thiếu kiến thức, mà là không biết cái gì thực sự phù hợp với mình.<br><br>
      <strong>💬 Mình hiểu.</strong> Và mình muốn giúp bạn lọc bớt nhiễu, để thấy rõ hơn đâu là điều bạn nên làm ngay bây giờ, vì thời gian chúng ta có hạn. Chúng ta nên tập những gì cần và đủ, thay vì tập lung tung mà không biết cơ thể cần hay không.<br><br>
    `;
  } else if (totalScore < 17) {
    scoreMessage = `
      <strong>Bạn chưa sẵn sàng – và đó chính xác lý do bạn đang ở đây.</strong><br><br>
      Bạn đang ở điểm xuất phát – nơi mọi thứ vẫn còn rất mới mẻ: từ tư thế ngồi, hơi thở, cơ sàn chậu cho tới việc phục hồi sau sinh. Có thể bạn chưa từng được hướng dẫn cụ thể, hoặc đơn giản là chưa từng được ai giải thích cặn kẽ.<br><br>
      <strong>💬 Không sao cả.</strong> Hành trình nào cũng bắt đầu từ việc nhận ra mình cần biết thêm. Mình ở đây để giúp bạn bắt đầu từ những bước đầu tiên phù hợp với tình trạng sức khoẻ của bạn nhất, tối ưu thời gian bạn có trong quá trình mang thai nhất.<br><br>
    `;
  }

  let endFinalMessage = `
    <strong>👉 Bạn muốn hiểu rõ: "Cơ thể mình thực sự đang cần gì?"</strong><br><br>
    Chia sẻ email ở form dưới đây, mình sẽ gửi bản phân tích chi tiết dựa trên từng câu trả lời của bạn trong quiz trong vòng 2-3 ngày. Vì mình cần thời gian xem câu trả lời của bạn kĩ, nên sẽ mất 2-3 ngày.<br><br>
    <strong>✨ Đã có nhiều mẹ bầu nhận được phân tích này và nói: "Giờ mình biết chính xác mình cần làm gì rồi!"</strong><br><br>
    <strong>BONUS:</strong> Mình sẽ gửi tặng kèm Mini challenge 3 ngày (mỗi ngày 1 email với hướng dẫn cụ thể), giúp bạn bắt đầu kết nối với cơ thể trong hành trình mang bầu này hơn.<br><br>
    Điền email để nhận kết quả phân tích chi tiết dành riêng cho bạn & email mini challenge.<br>
    <input type="email" id="userEmail" placeholder="Nhập email của bạn..." style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px;">
    <div id="emailError" style="color: #721c24; font-size: 14px; margin: 5px 0; display: none;"></div>
    <button type="button" onclick="submitEmail()" style="width: 100%; padding: 12px; background-color: #28a745; color: white; border: none; border-radius: 5px; font-weight: bold;">Gửi cho mình videos</button>
    <div id="emailSuccess" style="color: #155724; font-size: 14px; margin: 10px 0; display: none;">✅ Bạn hãy đón chờ email từ mình nhé!</div><br>
    Sau khi điền, bạn sẽ nhận được email confirmation & 1 video hướng dẫn tập thở 2 phút để có thể bắt đầu ngay.<br><br>
    Hành trình sinh nở là 1 hành trình thiêng liêng. Nó không chỉ sinh con mà còn sinh ra những bà mẹ mạnh mẽ, tự chủ và biết cách lắng nghe bản thân.<br><br>
    Thân,<br><br>
    Linh<br>
  `;

  // Calculate max possible score dynamically
  const maxPossibleScore = quizQuestions.reduce((total, question) => {
    const maxScoreForQuestion = Math.max(...question.options.map(option => option.score));
    return total + maxScoreForQuestion;
  }, 0);

  // Calculate score as percentage
  const scorePercentage = Math.round((totalScore / maxPossibleScore) * 100);

  finalScore.innerHTML = `
    <h3>KẾT QUẢ ĐÁNH GIÁ CỦA BẠN: ${scorePercentage}%</h3>
    <div>${scoreMessage}</div>
    <div>${endFinalMessage}</div>
  `;

  resultsDiv.style.display = 'block';
}

async function sendResultsToGoogleSheets() {
  const maxPossibleScore = quizQuestions.reduce((total, question) => {
    const maxScoreForQuestion = Math.max(...question.options.map(option => option.score));
    return total + maxScoreForQuestion;
  }, 0);

  const resultsData = {
    timestamp: new Date().toISOString(),
    totalQuestions: totalQuestions,
    totalScore: totalScore,
    maxPossibleScore: maxPossibleScore,
    answers: answers || {}
  };

  try {
    const response = await fetch(GOOGLE_SCRIPT_URL, {
      redirect: 'follow',
      method: 'POST',
      headers: {
        'Content-Type': 'text/plain;charset=utf-8',
      },
      body: JSON.stringify(resultsData)
    });

    if (response.ok) {
      const result = await response.json();
      console.log('Success:', result);

      const statusDiv = document.createElement('div');
      document.getElementById('results').appendChild(statusDiv);
    } else {
      throw new Error('Network response was not ok');
    }
  } catch (error) {
    console.error('Error:', error);
    // Handle error appropriately
  }
}

function retryQuiz() {
  initializeQuiz();
}

// Email validation and submission function
function submitEmail() {
  const emailInput = document.getElementById('userEmail');
  const emailError = document.getElementById('emailError');
  const emailSuccess = document.getElementById('emailSuccess');
  const email = emailInput.value.trim();

  // Hide previous messages
  emailError.style.display = 'none';
  emailSuccess.style.display = 'none';

  // Simple email validation regex
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if (!email) {
    emailError.textContent = 'Vui lòng nhập email của bạn.';
    emailError.style.display = 'block';
    return;
  }

  if (!emailRegex.test(email)) {
    emailError.textContent = 'Vui lòng nhập một địa chỉ email hợp lệ.';
    emailError.style.display = 'block';
    return;
  }

  // Add email to answers object
  answers.userEmail = {
    email: email,
    submittedAt: new Date().toISOString()
  };

  // Show success message
  emailSuccess.style.display = 'block';

  // Disable the input and button
  emailInput.disabled = true;
  emailInput.style.backgroundColor = '#f8f9fa';
  const button = emailInput.nextElementSibling.nextElementSibling; // Get the button after error div
  button.disabled = true;
  button.textContent = 'Đã ghi nhận email';
  button.style.backgroundColor = '#6c757d';

  console.log('Email recorded:', email);
  console.log('Updated answers:', answers);

  // Send results to Google Sheets
  sendResultsToGoogleSheets();
}

// Initialize quiz when page loads
window.addEventListener('load', initializeQuiz);
</script>
