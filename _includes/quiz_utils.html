<style>
  .quiz-container {
    max-width: 600px;
    margin: 20px auto;
    padding: 20px;
    font-family: Arial, sans-serif;
  }

  /* Progress Bar Styles */
  .progress-container {
    margin-bottom: 30px;
  }

  .progress-bar {
    width: 100%;
    height: 20px;
    background-color: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 10px;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #45a049);
    border-radius: 10px;
    transition: width 0.3s ease;
    width: 0%;
  }

  .progress-text {
    text-align: center;
    font-weight: bold;
    color: #555;
    font-size: 14px;
  }

  /* Question Styles */
  .quiz-question {
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .quiz-question h3 {
    margin-top: 0;
    color: #333;
  }

  .quiz-question label {
    display: flex;
    align-items: center;
    margin: 0.2em 0;
    padding: 0.4em;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .quiz-question label:hover {
    background-color: #f0f0f0;
  }

  .quiz-question label input[type="radio"] {
    margin-right: 8px;
  }

  .quiz-question.disabled label {
    pointer-events: none;
    opacity: 0.6;
  }

  .quiz-question.disabled input[type="radio"] {
    pointer-events: none;
  }

  /* Button Styles */
  button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    margin-right: 10px;
    transition: background-color 0.2s ease;
  }

  button:hover {
    background-color: #0056b3;
  }

  .next-btn {
    background-color: #28a745;
  }

  .next-btn:hover {
    background-color: #1e7e34;
  }

  .retry-btn {
    background-color: #6c757d;
  }

  .retry-btn:hover {
    background-color: #545b62;
  }

  /* Results Styles */
  .quiz-results {
    background-color: #f8f9fa;
    border: 2px solid #007bff;
    border-radius: 10px;
    padding: 30px;
    text-align: center;
    max-width: 100%;
    word-wrap: break-word;
  }

  .quiz-results h3 {
    color: #007bff;
    margin-top: 0;
  }

  #finalScore {
    font-size: 16px;
    margin: 20px 0;
    padding: 20px;
    background-color: white;
    border-radius: 8px;
    border: 1px solid #ddd;
    text-align: left;
    line-height: 1.5;
    max-height: 400px;
    overflow-y: auto;
  }
</style>

<script>
// ============================================
// GOOGLE SPREADSHEET INFORMATION
// ============================================
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxCoNSkAelfaCrIFnAkCJNnAKPoIDtKYQnXZjAGZ5pFZibYv5wNQRF7COuxaPewiGQv/exec';

// ============================================
// QUIZ CONFIGURATION - ADD/REMOVE QUESTIONS HERE
// ============================================
const quizQuestions = [
  {
    question: "B·∫°n c√≥ ƒë·ªÉ √Ω c√°ch m√¨nh ng·ªìi trong ng√†y kh√¥ng?",
    options: [
      { text: "Kh√¥ng ƒë·ªÉ √Ω m·∫•y, ho·∫∑c ch∆∞a bi·∫øt n√≥ ·∫£nh h∆∞·ªüng ƒë·∫øn vi·ªác sinh", score: 1 },
      { text: "C≈©ng c√≥ l√∫c ƒë·ªÉ √Ω, l√∫c th√¨ qu√™n", score: 2 },
      { text: "C√≥, m√¨nh c·ªë g·∫Øng gi·ªØ t∆∞ th·∫ø t·ªët m·ªói ng√†y", score: 3 }
    ]
  },
  {
    question: "Khi ng·ªß, b·∫°n th∆∞·ªùng n·∫±m nghi√™ng b√™n n√†o?",
    options: [
      { text: "N·∫±m ng·ª≠a ho·∫∑c t∆∞ th·∫ø n√†o th·∫•y d·ªÖ ng·ªß l√† ƒë∆∞·ª£c", score: 1 },
      { text: "Th·ªânh tho·∫£ng nghi√™ng tr√°i", score: 2 },
      { text: "M√¨nh hay n·∫±m nghi√™ng tr√°i ƒë·ªÉ gi√∫p tu·∫ßn ho√†n t·ªët h∆°n", score: 3 }
    ]
  },
  {
    question: "B·∫°n ƒë√£ t·ª´ng th·ª≠ t·∫≠p squat ho·∫∑c t∆∞ th·∫ø ‚Äúc√°i b√†n‚Äù ch∆∞a?",
    options: [
      { text: "Ch∆∞a bi·∫øt ƒë√≥ l√† g√¨ ho·∫∑c c√≥ √≠ch g√¨", score: 1 },
      { text: "C√≥ nghe qua nh∆∞ng ch∆∞a t·∫≠p th∆∞·ªùng xuy√™n", score: 2 },
      { text: "C√≥, m√¨nh t·∫≠p 1‚Äì2 l·∫ßn m·ªói tu·∫ßn ho·∫∑c h∆°n", score: 3 }
    ]
  },
  {
    question: "M·ªói ng√†y b·∫°n c√≥ di chuy·ªÉn nh·∫π nh√†ng kh√¥ng?",
    options: [
      { text: "Ch·ªß y·∫øu ng·ªìi nhi·ªÅu, √≠t v·∫≠n ƒë·ªông", score: 1 },
      { text: "Th·ªânh tho·∫£ng ƒëi b·ªô ho·∫∑c v·∫≠n ƒë·ªông nh·∫π", score: 2 },
      { text: "M·ªói ng√†y m√¨nh ƒë·ªÅu c√≥ l√∫c ƒëi b·ªô ho·∫∑c t·∫≠p yoga nh·∫π", score: 3 }
    ]
  },
  {
    question: "Khi th·∫•y cƒÉng th·∫≥ng hay ƒëau nh·∫π, b·∫°n c√≥ bi·∫øt c√°ch ƒë·ªÉ c∆° th·ªÉ th·∫£ l·ªèng l·∫°i kh√¥ng?",
    options: [
      { text: "Kh√¥ng, m√¨nh th∆∞·ªùng c·ª©ng ƒë∆° c·∫£ ng∆∞·ªùi", score: 1 },
      { text: "C√≥ th·ªÉ th·∫£ l·ªèng m·ªôt ph·∫ßn nh∆∞ vai hay c·ªï", score: 2 },
      { text: "C√≥, m√¨nh t·∫≠p trung th·∫£ l·ªèng c·∫£ c∆° th·ªÉ, ƒë·∫∑c bi·ªát l√† b·ª•ng v√† m·∫∑t", score: 3 }
    ]
  },
  {
    question: "Khi lo l·∫Øng, b·∫°n c√≥ bi·∫øt c√°ch d√πng h∆°i th·ªü ƒë·ªÉ b√¨nh tƒ©nh l·∫°i kh√¥ng?",
    options: [
      { text: "Kh√¥ng bi·∫øt ho·∫∑c ch∆∞a t·ª´ng th·ª≠", score: 1 },
      { text: "C√≥ bi·∫øt nh∆∞ng ch∆∞a quen d√πng", score: 2 },
      { text: "C√≥, m√¨nh hay d√πng th·ªü ƒë·ªÉ xoa d·ªãu b·∫£n th√¢n", score: 3 }
    ]
  },
  {
    question: "B·∫°n c√≥ t·ª´ng h·ªçc k·ªπ thu·∫≠t th·ªü cho t·ª´ng giai ƒëo·∫°n chuy·ªÉn d·∫° ch∆∞a?",
    options: [
      { text: "Ch∆∞a nghe bao gi·ªù", score: 1 },
      { text: "C√≥ ƒë·ªçc ho·∫∑c xem qua nh∆∞ng ch∆∞a t·∫≠p", score: 2 },
      { text: "C√≥ h·ªçc v√† th·ª±c h√†nh ƒë·ªÅu", score: 3 }
    ]
  },
  {
    question: "B·∫°n hi·ªÉu t·ªõi ƒë√¢u v·ªÅ c√°c giai ƒëo·∫°n c·ªßa qu√° tr√¨nh sinh?",
    options: [
      { text: "Ch∆∞a t√¨m hi·ªÉu k·ªπ", score: 1 },
      { text: "Bi·∫øt s∆° s∆° nh∆∞ng ch∆∞a bi·∫øt ph·∫£i l√†m g√¨ t·ª´ng giai ƒëo·∫°n", score: 2 },
      { text: "M√¨nh hi·ªÉu r√µ v√† bi·∫øt m√¨nh s·∫Ω l√†m g√¨ trong t·ª´ng giai ƒëo·∫°n", score: 3 }
    ]
  },
  {
    question: "B·∫°n c√≥ t·ª´ng t·∫≠p c√°ch c·∫£m nh·∫≠n ho·∫∑c ƒëi·ªÅu khi·ªÉn c∆° s√†n ch·∫≠u kh√¥ng?",
    options: [
      { text: "Ch∆∞a bao gi·ªù nghe t·ªõi ho·∫∑c bi·∫øt l√†m sao t·∫≠p", score: 1 },
      { text: "C√≥ nghe n√≥i nh∆∞ng kh√¥ng ch·∫Øc m√¨nh l√†m ƒë√∫ng", score: 2 },
      { text: "C√≥, m√¨nh c·∫£m nh·∫≠n ƒë∆∞·ª£c r√µ r√†ng khi si·∫øt/th·∫£", score: 3 }
    ]
  },
  {
    question: "B·∫°n c√≥ hay b·ªã s√≥n ti·ªÉu khi ho, h·∫Øt h∆°i ho·∫∑c c∆∞·ªùi to kh√¥ng?",
    options: [
      { text: "C√≥, x·∫£y ra kh√° th∆∞·ªùng xuy√™n", score: 1 },
      { text: "Th·ªânh tho·∫£ng b·ªã", score: 2 },
      { text: "Kh√¥ng b·ªã", score: 3 }
    ]
  },
  {
    question: "B·∫°n ƒë√£ t·ª´ng t√¨m hi·ªÉu ho·∫∑c b·∫Øt ƒë·∫ßu t·∫≠p ph·ª•c h·ªìi s√†n ch·∫≠u ch∆∞a?",
    options: [
      { text: "Ch∆∞a t·ª´ng nghe ƒë·∫øn", score: 1 },
      { text: "C√≥ bi·∫øt nh∆∞ng ch∆∞a b·∫Øt ƒë·∫ßu", score: 2 },
      { text: "C√≥ r·ªìi, m√¨nh ƒëang t·∫≠p ho·∫∑c ƒë√£ l√™n k·∫ø ho·∫°ch", score: 3 }
    ]
  },
  {
    question: "B·∫°n c√≥ bi·∫øt t∆∞ th·∫ø n√†o gi√∫p em b√© ƒëi xu·ªëng d·ªÖ h∆°n kh√¥ng?",
    options: [
      { text: "Ch∆∞a t√¨m hi·ªÉu", score: 1 },
      { text: "C√≥ nghe n√≥i v√†i t∆∞ th·∫ø nh∆∞ng ch∆∞a quen t·∫≠p", score: 2 },
      { text: "Bi·∫øt r√µ v√† ƒëang √°p d·ª•ng nh∆∞ ƒë·ª©ng t·ª±a, nghi√™ng ng∆∞·ªùi, all fours...", score: 3 }
    ]
  },
  {
    question: "B·∫°n c√≥ t·ª´ng t·∫≠p th·∫£ l·ªèng v√πng √¢m ƒë·∫°o v√† t·∫ßng sinh m√¥n kh√¥ng?",
    options: [
      { text: "Ch∆∞a bi·∫øt c√≥ th·ªÉ t·∫≠p ƒëi·ªÅu n√†y", score: 1 },
      { text: "C√≥ nghe qua nh∆∞ng ch∆∞a th·ª±c h√†nh ƒë∆∞·ª£c", score: 2 },
      { text: "C√≥, m√¨nh ƒëang luy·ªán t·∫≠p v√† c·∫£m nh·∫≠n r√µ", score: 3 }
    ]
  },
  {
    question: "N·∫øu ca sinh di·ªÖn ra kh√¥ng nh∆∞ k·∫ø ho·∫°ch, b·∫°n s·∫Ω...",
    options: [
      { text: "R·∫•t lo l·∫Øng, d·ªÖ ho·∫£ng", score: 1 },
      { text: "Lo nh∆∞ng s·∫Ω c·ªë gi·ªØ b√¨nh tƒ©nh", score: 2 },
      { text: "M√¨nh ƒë√£ chu·∫©n b·ªã tinh th·∫ßn ƒë·ªÉ linh ho·∫°t v√† ·ª©ng bi·∫øn", score: 3 }
    ]
  },
  {
    question: "Khi nghƒ© ƒë·∫øn sinh con, b·∫°n c·∫£m th·∫•y...",
    options: [
      { text: "S·ª£ v√† kh√¥ng tin m√¨nh l√†m ƒë∆∞·ª£c", score: 1 },
      { text: "Lo nh∆∞ng v·∫´n c·ªë nghƒ© t√≠ch c·ª±c", score: 2 },
      { text: "C√≥ ni·ªÅm tin l√† m√¨nh s·∫Ω l√†m ƒë∆∞·ª£c", score: 3 }
    ]
  },
  {
    question: "B·∫°n ƒë√£ chu·∫©n b·ªã k·∫ø ho·∫°ch sinh (birth plan) v√† n√≥i chuy·ªán v·ªõi b√°c sƒ© ch∆∞a?",
    options: [
      { text: "Ch∆∞a t·ª´ng nghƒ© t·ªõi ho·∫∑c ch∆∞a t√¨m hi·ªÉu", score: 1 },
      { text: "C√≥ √Ω t∆∞·ªüng nh∆∞ng ch∆∞a n√≥i chuy·ªán v·ªõi ai", score: 2 },
      { text: "M√¨nh ƒë√£ vi·∫øt k·∫ø ho·∫°ch v√† th·∫£o lu·∫≠n v·ªõi b√°c sƒ©/n·ªØ h·ªô sinh", score: 3 }
    ]
  },
  {
    question: "B·∫°n ƒëang ·ªü tu·∫ßn thai th·ª© m·∫•y r·ªìi?",
    options: [
      { text: "D∆∞·ªõi 28 tu·∫ßn", score: 1 },
      { text: "28‚Äì36 tu·∫ßn", score: 2 },
      { text: "Tr√™n 36 tu·∫ßn", score: 3 }
    ]
  }
];

// ============================================
// QUIZ LOGIC - DON'T CHANGE BELOW THIS LINE
// ============================================
let currentQuestion = 0;
let totalQuestions = quizQuestions.length;
let totalScore = 0;
let answers = {};

function initializeQuiz() {
  currentQuestion = 0;
  totalScore = 0;
  answers = {};
  totalQuestions = quizQuestions.length;

  // Clear container
  document.getElementById('questionContainer').innerHTML = '';
  document.getElementById('results').style.display = 'none';

  // Generate all questions
  generateQuestions();

  // Show first question
  showQuestion(0);
  updateProgress();
}

function generateQuestions() {
  const container = document.getElementById('questionContainer');

  quizQuestions.forEach((q, index) => {
    const questionDiv = document.createElement('div');
    questionDiv.className = 'quiz-question';
    questionDiv.id = `question${index}`;
    questionDiv.style.display = 'none';

    let optionsHTML = '';
    q.options.forEach((option, optionIndex) => {
      optionsHTML += `
        <label>
          <input type="radio" name="q${index}" value="${optionIndex}" data-score="${option.score}"> ${option.text}
        </label>
      `;
    });

    const isLastQuestion = index === quizQuestions.length - 1;
    const nextButtonText = isLastQuestion ? 'Xem K·∫øt Qu·∫£' : 'C√¢u Ti·∫øp Theo';
    const nextButtonAction = isLastQuestion ? 'showResults()' : 'nextQuestion()';

    questionDiv.innerHTML = `
      <h3>C√¢u ${index + 1}</h3>
      <p><strong>${q.question}</strong></p>
      <form>
        ${optionsHTML}
        <br>
        <button type="button" onclick="submitAnswer(this, ${index})">G·ª≠i C√¢u Tr·∫£ L·ªùi</button>
        <button type="button" onclick="${nextButtonAction}" style="display: none;" class="next-btn">${nextButtonText}</button>
      </form>
      <p class="quiz-feedback" style="font-weight:bold;"></p>
    `;

    container.appendChild(questionDiv);
  });
}

function showQuestion(questionIndex) {
  // Hide all questions
  document.querySelectorAll('.quiz-question').forEach(q => {
    q.style.display = 'none';
  });

  // Show current question
  const currentQuestionDiv = document.getElementById(`question${questionIndex}`);
  if (currentQuestionDiv) {
    currentQuestionDiv.style.display = 'block';
  }
}

function updateProgress() {
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');

  const progressPercentage = Math.round(((currentQuestion + 1) / totalQuestions) * 100);

  progressFill.style.width = progressPercentage + '%';
  progressText.textContent = `C√¢u ${currentQuestion + 1} / ${totalQuestions} (${progressPercentage}%)`;
}

function nextQuestion() {
  currentQuestion++;
  if (currentQuestion < totalQuestions) {
    showQuestion(currentQuestion);
    updateProgress();
  }
}

function submitAnswer(button, questionIndex) {
  const questionDiv = button.closest('.quiz-question');
  const selectedInput = questionDiv.querySelector(`input[name="q${questionIndex}"]:checked`);
  const feedback = questionDiv.querySelector('.quiz-feedback');
  const submitBtn = button;
  const nextBtn = questionDiv.querySelector('.next-btn');

  if (!selectedInput) {
    feedback.textContent = 'Vui l√≤ng ch·ªçn m·ªôt c√¢u tr·∫£ l·ªùi tr∆∞·ªõc khi g·ª≠i.';
    feedback.style.color = '#721c24';
    return;
  }

  const userAnswerIndex = parseInt(selectedInput.value);
  const userScore = parseInt(selectedInput.dataset.score);

  // Store the answer with score
  answers[`q${questionIndex}`] = {
    selected: userAnswerIndex,
    score: userScore,
    question: quizQuestions[questionIndex].question,
    selectedText: quizQuestions[questionIndex].options[userAnswerIndex].text
  };

  // Add to total score
  totalScore += userScore;

  // Disable radio buttons after submit
  questionDiv.classList.add('disabled');

  // Hide submit button and show next button
  submitBtn.style.display = 'none';
  nextBtn.style.display = 'inline-block';
}

function showResults() {
  // Hide current question
  document.querySelectorAll('.quiz-question').forEach(q => {
    q.style.display = 'none';
  });

  // Update progress to 100%
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');
  progressFill.style.width = '100%';
  progressText.textContent = 'Ho√†n Th√†nh! (100%)';

  // Show results with scoring message
  const resultsDiv = document.getElementById('results');
  const finalScore = document.getElementById('finalScore');

  // Determine message based on total score
  let scoreMessage = '';
  if (totalScore >= 44) {
    scoreMessage = `
      <strong>B·∫°n ƒëang r·∫•t g·∫ßn r·ªìi ‚Äì h√£y ti·∫øp t·ª•c nu√¥i d∆∞·ª°ng tr·∫°ng th√°i s·∫µn s√†ng n√†y.</strong><br><br>
      C∆° th·ªÉ b·∫°n ƒëang ph·∫£n h·ªìi r·∫•t t·ªët ‚Äì ƒëi·ªÅu ƒë√≥ cho th·∫•y b·∫°n ƒë√£ t√≠ch l≈©y ƒë∆∞·ª£c n·ªÅn t·∫£ng ·ªïn ƒë·ªãnh c·∫£ v·ªÅ th·ªÉ ch·∫•t v√† tinh th·∫ßn.<br><br>
      ƒê·ªÉ gi√∫p b·∫°n duy tr√¨ s·ª± s·∫µn s√†ng n√†y, m√¨nh ƒë√£ chu·∫©n b·ªã mini th·ª≠ th√°ch 3 ng√†y ‚Äì m·ªói ng√†y, b·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c m·ªôt video nh·ªè nh∆∞ng tinh g·ªçn:<br><br>
      <strong>Ng√†y 1:</strong> Audio 102 c√¢u n√≥i t√≠ch c·ª±c ‚Äì d√†nh nghe l√∫c ngh·ªâ ng∆°i, ho·∫∑c l√∫c g√≤<br>
      <strong>Ng√†y 2:</strong> 2 ƒë·ªông t√°c gi√∫p gi·ªØ nh·ªãp v·∫≠n ƒë·ªông v√† m·ªü h√¥ng<br>
      <strong>Ng√†y 3:</strong> G·ª£i √Ω ƒëi·ªÅu ch·ªânh nh·ªãp th·ªü khi c∆°n g√≤ ƒë·∫øn<br><br>
    `;
  } else if (totalScore >= 34 && totalScore < 44) {
    scoreMessage = `
      <strong>B·∫°n ƒëang ·ªü ng√£ r·∫Ω ‚Äì n∆°i ch·ªâ c·∫ßn ƒëi·ªÅu ch·ªânh nh·∫π, m·ªçi th·ª© s·∫Ω kh·ªõp l·∫°i.</strong><br><br>
      B·∫°n ƒë√£ c√≥ m·ªôt s·ªë n·ªÅn t·∫£ng, nh∆∞ng c∆° th·ªÉ v·∫´n ƒëang ch·ªù b·∫°n ‚Äúg·ª° m·ªôt n√∫t th·∫Øt nh·ªè‚Äù ‚Äì c√≥ th·ªÉ l√† t∆∞ th·∫ø, nh·ªãp th·ªü ho·∫∑c t√¢m l√Ω ch∆∞a th·ª±c s·ª± th·∫£ l·ªèng.<br><br>
      M√¨nh ƒë√£ chu·∫©n b·ªã cho b·∫°n chu·ªói 3 ng√†y k·∫øt n·ªëi l·∫°i ‚Äì gi√∫p b·∫°n soi r√µ v√† ƒëi·ªÅu ch·ªânh nh·∫π t·ª´ nh·ªØng g√¨ ƒëang c√≥:<br><br>
      <strong>Ng√†y 1:</strong> Video "Ng·ªìi ƒë√∫ng ‚Äì ƒë·∫ª nh·∫π"<br>
      <strong>Ng√†y 2:</strong> Th·ªü ch·∫≠m ‚Äì c√°ch ƒëi·ªÅu ch·ªânh khi c∆°n g√≤ ƒë·∫øn<br>
      <strong>Ng√†y 3:</strong> Audio 102 c√¢u n√≥i t√≠ch c·ª±c ‚Äì d√†nh nghe l√∫c ngh·ªâ ng∆°i, ho·∫∑c l√∫c g√≤<br><br>
    `;
  } else if (totalScore >= 17 && totalScore < 34) {
    scoreMessage = `
      <strong>C∆° th·ªÉ b·∫°n ƒëang l√™n ti·∫øng ‚Äì v√† b·∫°n c√≥ th·ªÉ l·∫Øng nghe ngay t·ª´ h√¥m nay.</strong><br><br>
      K·∫øt qu·∫£ n√†y kh√¥ng c√≥ g√¨ sai ‚Äì n√≥ ch·ªâ nh·∫Øc r·∫±ng: "M√¨nh c·∫ßn ƒë∆∞·ª£c quan t√¢m h∆°n m·ªôt ch√∫t."<br><br>
      H√†nh tr√¨nh chu·∫©n b·ªã cho sinh n·ªü b·∫Øt ƒë·∫ßu t·ª´ nh·ªØng vi·ªác r·∫•t ƒë∆°n gi·∫£n ‚Äì khi b·∫°n l√†m ƒë√∫ng ch·ªó, m·ªçi th·ª© s·∫Ω kh·ªõp l·∫°i t·ª± nhi√™n.<br><br>
      Mini th·ª≠ th√°ch 3 ng√†y n√†y l√† b∆∞·ªõc ƒë·∫ßu ƒë·ªÉ b·∫°n k·∫øt n·ªëi l·∫°i nh·∫π nh√†ng:<br><br>
      <strong>Ng√†y 1:</strong> Video C∆° s√†n ch·∫≠u 101 ‚Äì b√†i t·∫≠p n·ªÅn ƒë·∫ßu ti√™n<br>
      <strong>Ng√†y 2:</strong> T∆∞ th·∫ø ng·ªìi t·ªëi ∆∞u ‚Äì gi√∫p b√© v√†o v·ªã tr√≠ d·ªÖ sinh<br>
      <strong>Ng√†y 3:</strong> H√≠t th·ªü ƒë√∫ng c√°ch ƒë·ªÉ b√¨nh tƒ©nh h∆°n m·ªói ng√†y<br><br>
    `;
  } else if (totalScore < 17) {
    scoreMessage = `
      <strong>Ch∆∞a s·∫µn s√†ng kh√¥ng c√≥ nghƒ©a l√† kh√¥ng th·ªÉ ‚Äì b·∫°n ch·ªâ ƒëang c·∫ßn m·ªôt ƒëi·ªÉm b·∫Øt ƒë·∫ßu ƒë√∫ng ƒë·∫Øn.</strong><br><br>
      N·∫øu b·∫°n c·∫£m th·∫•y m√¨nh c√≤n m√¥ng lung ‚Äì ƒëi·ªÅu ƒë√≥ ho√†n to√†n b√¨nh th∆∞·ªùng. B·∫°n ƒëang b·∫Øt ƒë·∫ßu m·ªôt ƒëi·ªÅu m·ªõi, v√† ƒëi·ªÅu quan tr·ªçng l√†: b·∫°n ƒë√£ d·ª´ng l·∫°i ƒë·ªÉ l·∫Øng nghe.<br><br>
      3 video trong 3 ng√†y t·ªõi s·∫Ω gi√∫p b·∫°n kh·ªüi ƒë·ªông l·∫°i, nh·∫π nh√†ng m√† ƒë·ªß s√¢u:<br><br>
      <strong>Ng√†y 1:</strong> H√≠t th·ªü 2 ph√∫t ‚Äì ƒë·ªÉ xoa d·ªãu v√† ·ªïn ƒë·ªãnh l·∫°i<br>
      <strong>Ng√†y 2:</strong> T∆∞ th·∫ø ng·ªìi ‚Äì c√°ch ƒë∆°n gi·∫£n nh·∫•t ƒë·ªÉ n√¢ng ƒë·ª° b√©<br>
      <strong>Ng√†y 3:</strong> C∆° s√†n ch·∫≠u nh·∫π nh√†ng ‚Äì v·ª´a s·ª©c, kh√¥ng √°p l·ª±c<br><br>
    `;
  }

  let endFinalMessage = `
    ƒê·ªÉ nh·∫≠n ƒë·ªß 3 video trong 3 ng√†y t·ªõi:<br><br>
    üëâ ƒêi·ªÅn email c·ªßa b·∫°n v√†o √¥ b√™n d∆∞·ªõi ‚Äì H√£y ƒë·∫£m b·∫£o email ƒë√∫ng ƒë·ªÉ nh·∫≠n ƒë∆∞·ª£c videos üíå<br><br>
    <input type="email" id="userEmail" placeholder="Nh·∫≠p email c·ªßa b·∫°n..." style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px;">
    <div id="emailError" style="color: #721c24; font-size: 14px; margin: 5px 0; display: none;"></div>
    <button type="button" onclick="submitEmail()" style="width: 100%; padding: 12px; background-color: #28a745; color: white; border: none; border-radius: 5px; font-weight: bold;">G·ª≠i cho m√¨nh videos</button>
    <div id="emailSuccess" style="color: #155724; font-size: 14px; margin: 10px 0; display: none;">‚úÖ Email ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n th√†nh c√¥ng!</div>
  `;

  // Calculate max possible score dynamically
  const maxPossibleScore = quizQuestions.reduce((total, question) => {
    const maxScoreForQuestion = Math.max(...question.options.map(option => option.score));
    return total + maxScoreForQuestion;
  }, 0);

  // Calculate score as percentage
  const scorePercentage = Math.round((totalScore / maxPossibleScore) * 100);

  finalScore.innerHTML = `
    <h3>K·∫øt qu·∫£ ƒë√°nh gi√°: ${scorePercentage}%</h3>
    <div>${scoreMessage}</div>
    <div>${endFinalMessage}</div>
  `;

  resultsDiv.style.display = 'block';
}

function sendResultsToGoogleSheets() {
  // Calculate max possible score dynamically
  const maxPossibleScore = quizQuestions.reduce((total, question) => {
    const maxScoreForQuestion = Math.max(...question.options.map(option => option.score));
    return total + maxScoreForQuestion;
  }, 0);

  const resultsData = {
    timestamp: new Date().toISOString(),
    totalQuestions: totalQuestions,
    totalScore: totalScore,
    maxPossibleScore: maxPossibleScore,
    answers: answers || {}
  };

  console.log('Sending data:', resultsData);

  // Create a JSONP request
  const script = document.createElement('script');
  const callbackName = 'jsonpCallback' + Date.now();

  // Create global callback function
  window[callbackName] = function(response) {
    console.log('Response:', response);
    // Show success message
    const statusDiv = document.createElement('div');
    statusDiv.innerHTML = '‚úÖ Results successfully saved!';
    document.getElementById('results').appendChild(statusDiv);

    // Cleanup
    document.head.removeChild(script);
    delete window[callbackName];
  };

  // Build URL with data as query parameters
  const params = new URLSearchParams({
    callback: callbackName,
    data: JSON.stringify(resultsData)
  });

  script.src = `${GOOGLE_SCRIPT_URL}?${params}`;
  document.head.appendChild(script);
}

function retryQuiz() {
  initializeQuiz();
}

// Email validation and submission function
function submitEmail() {
  const emailInput = document.getElementById('userEmail');
  const emailError = document.getElementById('emailError');
  const emailSuccess = document.getElementById('emailSuccess');
  const email = emailInput.value.trim();

  // Hide previous messages
  emailError.style.display = 'none';
  emailSuccess.style.display = 'none';

  // Simple email validation regex
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if (!email) {
    emailError.textContent = 'Vui l√≤ng nh·∫≠p email c·ªßa b·∫°n.';
    emailError.style.display = 'block';
    return;
  }

  if (!emailRegex.test(email)) {
    emailError.textContent = 'Vui l√≤ng nh·∫≠p m·ªôt ƒë·ªãa ch·ªâ email h·ª£p l·ªá.';
    emailError.style.display = 'block';
    return;
  }

  // Add email to answers object
  answers.userEmail = {
    email: email,
    submittedAt: new Date().toISOString()
  };

  // Show success message
  emailSuccess.style.display = 'block';

  // Disable the input and button
  emailInput.disabled = true;
  emailInput.style.backgroundColor = '#f8f9fa';
  const button = emailInput.nextElementSibling.nextElementSibling; // Get the button after error div
  button.disabled = true;
  button.textContent = 'ƒê√£ ghi nh·∫≠n email';
  button.style.backgroundColor = '#6c757d';

  console.log('Email recorded:', email);
  console.log('Updated answers:', answers);

  // Send results to Google Sheets
  sendResultsToGoogleSheets();
}

// Initialize quiz when page loads
window.addEventListener('load', initializeQuiz);
</script>
